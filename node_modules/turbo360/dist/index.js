var superagent=require("superagent"),Promise=require("bluebird"),StripeUtils=require("./utils/StripeUtils"),Auth=require("./utils/Auth"),IndexDB=require("./utils/IndexDB"),Functions=require("./utils/Functions"),Microservice=function(e){const r="https://velocity-microservices.herokuapp.com";var i={site_id:e.site_id,base_url:r},t=function(e,t){return null==t&&(t={}),t.site=i.site_id,new Promise(function(i,n){return null==t.site?void n(new Error("Please Set Your TURBO_APP_ID")):0==t.site.length?void n(new Error("Please Set Your TURBO_APP_ID")):void superagent.get(r+"/api/"+e.toLowerCase()).query(t).set("Accept","application/json").end(function(e,r){if(e)return void n(e);if("fail"==r.body.confirmation)return void n(new Error(r.body.message));var t=r.body.results;i(t)})})},n=function(e,t){return new Promise(function(n,o){return null==i.site_id?void o(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void o(new Error("Please Set Your TURBO_APP_ID")):void superagent.get(r+"/api/"+e.toLowerCase()+"/"+t).query(null).set("Accept","application/json").end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var i=r.body.result;n(i)})})},o=function(e,t){return new Promise(function(n,o){return null==i.site_id?void o(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void o(new Error("Please Set Your TURBO_APP_ID")):null==t?void o(new Error("Post parameters required.")):(t.site=i.site_id,void superagent.post(r+"/api/"+e.toLowerCase()).send(t).set("Accept","application/json").end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var i=r.body.result||r.body.results;n(i)}))})},s=function(e,t,n){return new Promise(function(o,s){return null==i.site_id?void s(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void s(new Error("Please Set Your TURBO_APP_ID")):null==n?void s(new Error("Post parameters required.")):(Object.keys(n).forEach(function(e,r){var i=n[e];t[e]=i}),void superagent.put(r+"/api/"+e.toLowerCase()+"/"+t.id).send(t).set("Accept","application/json").end(function(e,r){if(e)return void s(e);if("fail"==r.body.confirmation)return void s(new Error(r.body.message));var i=r.body.result||r.body.results;o(i)}))})},u=function(e,t){return new Promise(function(n,o){return null==i.site_id?void o(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void o(new Error("Please Set Your TURBO_APP_ID")):void superagent.delete(r+"/api/"+e+"/"+t.id).set("Accept","application/json").end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var i=r.body.result||r.body.results;n(i)})})},a=function(e){return new Promise(function(t,n){return null==i.site_id?void n(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void n(new Error("Please Set Your TURBO_APP_ID")):null==e?void n(new Error("Post parameters required.")):(e.site=i.site_id,e.exec="sendemail",void superagent.post(r+"/functions").send(e).set("Accept","application/json").end(function(e,r){return e?void n(e):"fail"==r.body.confirmation?void n(new Error(r.body.message)):void t(r.body.result)}))})},d=StripeUtils(i),c=Auth(i),l=Functions(i);return{fetch:t,fetchOne:n,create:o,update:s,remove:u,sendEmail:a,login:c.login,logout:c.logout,createUser:c.createUser,currentUser:c.currentUser,createStripeCharge:d.createStripeCharge,createStripeAccount:d.createStripeAccount,recurringCharge:d.recurringCharge,initializeStripe:d.initializeStripe,submitStripeCharge:d.submitStripeCharge,executeFunction:l.executeFunction}};module.exports=Microservice;